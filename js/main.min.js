/*  barba-main.js
    handles page transition effect
    source: http://barbajs.org/transition.html
*/

$(function () {
    Barba.Pjax.start();
    Barba.Prefetch.init();

    var FadeTransition = Barba.BaseTransition.extend({
        start: function () {
            /**
             * This function is automatically called as soon the Transition starts
             * this.newContainerLoading is a Promise for the loading of the new container
             * (Barba.js also comes with an handy Promise polyfill!)
             */

            // As soon the loading is finished and the old page is faded out, let's fade the new page
            Promise
                .all([this.newContainerLoading, this.fadeOut()])
                .then(this.fadeIn.bind(this));
        },

        fadeOut: function () {
            /**
             * this.oldContainer is the HTMLElement of the old Container
             */

            return $(this.oldContainer).animate({
                opacity: 0
            }).promise();
        },

        fadeIn: function () {
            /**
             * this.newContainer is the HTMLElement of the new Container
             * At this stage newContainer is on the DOM (inside our #barba-container and with visibility: hidden)
             * Please note, newContainer is available just after newContainerLoading is resolved!
             */

            //$(window).scrollTop(0);
            $("html, body").animate({ scrollTop: 0 }, 250);

            var _this = this;
            var $el = $(this.newContainer);

            $(this.oldContainer).hide();

            $el.css({
                visibility: 'visible',
                opacity: 0
            });

            $el.animate({
                opacity: 1
            }, 800, function () {
                _this.done();
            });
        }
    });

    Barba.Pjax.getTransition = function () {
        return FadeTransition;
    };


});

/*  navbar.js
    controls the toggling of the fold down menu
*/

$(function(){
    $(".navbar-toggle").click(function(){
        $(".main-nav").toggleClass("active");
        $(".navbar-toggle").toggleClass("toggled");
    });
});
/*  accessibility.js
    controls the function of the accessibility page
*/

var stylesheet = `<style id="high-contrast-style">
                            html {
                              background: black !important;
                              color: yellow; }

                            a {
                              color: yellow !important; }

                            .navbar {
                              background: black; }
                              .navbar picture {
                                filter: invert(100%); }

                            textarea, input, button {
                              border: 1px solid white;
                              background: black; }

                            textarea, input {
                              color: yellow; }

                            ::placeholder {
                              color: #b2b200; }

                            button {
                              color: yellow; }

                            gallery-item span {
                              color: yellow; }
                        </style>`

function toggleCookie(name) {

    var val = Cookies.get(name);

    if (val === undefined || val == 'false') {
        Cookies.set(name, 'true');
    } else {
        Cookies.set(name, 'false');
    }
}

$(function () {

    if (Cookies.get('high-contrast') == 'true') {
        $('head').append(stylesheet);
    }

    if (Cookies.get('invert') == 'true') {
        $('html').toggleClass('invert');
    }

    $(document).on('click', '#invert', function () {
        $('html').toggleClass("invert");
        toggleCookie('invert');
    });


    $(document).on('click', '#high-contrast', function () {

        if (!$('#high-contrast-style').length) {
            $('head').append(stylesheet);
            Cookies.set('high-contrast', 'true');
        } else {
            $('#high-contrast-style').remove();
            Cookies.set('high-contrast', 'false');
        }
    });
});
